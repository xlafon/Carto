<!DOCTYPE html>
<html>
<head>
  <title>Carte Leaflet - Infobox avec Points GeoJSON</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    #map { height: 600px; }
    #route-selector {
      margin: 10px;
    }
    .stop-point {
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: inline-block;
      margin-left: -9px;
      margin-top: -9px;
      border: 2px solid white;
    }
    #route-info {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background-color: rgba(255, 255, 255, 0.9);
      padding: 10px;
      border-radius: 5px;
      width: 250px;
      height: 200px;
      overflow-y: auto;
      display: none;
      z-index: 1000;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    }
    #route-title {
      font-size: 16px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div id="route-selector">
  <label for="routeSelect">Choisir une ligne de transport :</label>
  <select id="routeSelect">
    <option value="">Sélectionner un arrêt</option>
    <option value="all">Afficher tous les arrêts</option>
  </select>
</div>

<div id="map"></div>

<!-- Panneau d'informations -->
<div id="route-info">
  <h4 id="route-title"></h4>
  <div id="route-content"></div>
</div>

<script>
// Initialisation de la carte centrée sur Bayonne
var map = L.map('map').setView([43.492949, -1.474841], 13); // Coordonnées de Bayonne

// Ajouter une couche de tuiles OpenStreetMap
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19
}).addTo(map);

// Liste des marqueurs pour les arrêts affichés
let markersLayer = L.layerGroup().addTo(map);

// Charger le fichier GeoJSON
async function loadGeoJSONData() {
  const response = await fetch('data/TXIKNORD.geojson'); // Chemin du fichier GeoJSON
  const data = await response.json();
  return data;
}

// Ajouter les arrêts au menu déroulant
function addStopsToMenu(features) {
  const stopSelect = document.getElementById('routeSelect');
  
  features.forEach(feature => {
    const stopName = feature.properties.name;
    const stopId = feature.properties.id;
    
    // Ajouter chaque arrêt dans le menu
    if (stopName && stopId) {
      const option = document.createElement('option');
      option.value = stopId;
      option.textContent = stopName;
      stopSelect.appendChild(option);
    }
  });

  // Lorsque l'utilisateur sélectionne un arrêt
  stopSelect.addEventListener('change', function () {
    const selectedStopId = this.value;
    if (selectedStopId === "all") {
      afficherTousLesArrets(features); // Afficher tous les arrêts si sélectionné
    } else if (selectedStopId !== "") {
      afficherArret(features, selectedStopId);
    } else {
      clearPreviousMarkersAndInfo(); // Effacer les arrêts et masquer l'infobox si aucun arrêt n'est sélectionné
    }
  });
}

// Effacer les marqueurs et l'infobox
function clearPreviousMarkersAndInfo() {
  markersLayer.clearLayers();
  document.getElementById('route-info').style.display = 'none'; // Masquer le panneau d'informations
}

// Afficher un arrêt sélectionné
function afficherArret(features, selectedStopId) {
  clearPreviousMarkersAndInfo(); // Effacer les anciens arrêts

  const selectedFeature = features.find(feature => feature.properties.id === selectedStopId);

  if (selectedFeature) {
    const coords = selectedFeature.geometry.coordinates;
    const lat = coords[1];
    const lon = coords[0];

    const stopPoint = L.divIcon({
      className: 'stop-point',
      html: `<div style="background-color:#FF0000;"></div>`, // Couleur pour les arrêts
      iconSize: [18, 18]
    });

    // Ajouter le marqueur de l'arrêt sélectionné
    const marker = L.marker([lat, lon], { icon: stopPoint }).on('click', function () {
      afficherInfoArret(selectedFeature.properties);
    });
    markersLayer.addLayer(marker);

    // Centrer la carte sur l'arrêt
    map.setView([lat, lon], 15);

    // Afficher les informations de l'arrêt dans l'infobox
    afficherInfoArret(selectedFeature.properties);
  }
}

// Afficher tous les arrêts
function afficherTousLesArrets(features) {
  clearPreviousMarkersAndInfo(); // Effacer les anciens arrêts

  features.forEach(feature => {
    const coords = feature.geometry.coordinates;
    const lat = coords[1];
    const lon = coords[0];

    const stopPoint = L.divIcon({
      className: 'stop-point',
      html: `<div style="background-color:#FF0000;"></div>`, // Couleur pour les arrêts
      iconSize: [18, 18]
    });

    // Ajouter chaque arrêt sous forme de marqueur
    const marker = L.marker([lat, lon], { icon: stopPoint }).on('click', function () {
      afficherInfoArret(feature.properties);
    });
    markersLayer.addLayer(marker);
  });
}

// Afficher les informations d'un arrêt dans l'infobox
function afficherInfoArret(properties) {
  const stopTitle = `<b>${properties.name}</b>`;
  const content = `
    <p><b>Description :</b> ${properties.description}</p>
    <p><b>ID :</b> ${properties.id}</p>
    <p><b>Accessibilité :</b> ${properties.wheelchair_boarding}</p>
  `;
  
  document.getElementById('route-title').innerHTML = stopTitle;
  document.getElementById('route-content').innerHTML = content;
  document.getElementById('route-info').style.display = 'block';
}

// Charger les données GeoJSON et ajouter les arrêts dans le menu déroulant
loadGeoJSONData().then(data => {
  addStopsToMenu(data.features);
});
</script>

<!-- Charger la librairie Leaflet -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

</body>
</html>
1
