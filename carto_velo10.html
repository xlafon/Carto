<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Carte avec Leaflet</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <style>
    :root {
      --primary-color: #007bff;
      --secondary-color: #dc3545;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --hover-darken: 0.1;
    }

    .leaflet-control-custom {
      background-color: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
    }

    .leaflet-control-custom button {
      display: block;
      width: 100%;
      margin-bottom: 5px;
      padding: 5px;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }

    .leaflet-control-custom .offices-button {
      background-color: var(--primary-color);
    }

    .leaflet-control-custom .offices-button:hover {
      background-color: darken(var(--primary-color), var(--hover-darken));
    }

    .leaflet-control-custom .parcours-button {
      background-color: var(--secondary-color);
    }

    .leaflet-control-custom .parcours-button:hover {
      background-color: darken(var(--secondary-color), var(--hover-darken));
    }

    .leaflet-control-custom .bike-button {
      background-color: var(--warning-color);
    }

    .leaflet-control-custom .bike-button:hover {
      background-color: darken(var(--warning-color), var(--hover-darken));
    }

    .leaflet-control-custom .accommodations-button {
      background-color: var(--success-color);
    }

    .leaflet-control-custom .accommodations-button:hover {
      background-color: darken(var(--success-color), var(--hover-darken));
    }

    .selected-icons {
      position: absolute;
      top: 10px;
      left: 100px;
      background-color: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      display: flex;
      gap: 10px;
      z-index: 1000;
    }

    .selected-icons img {
      width: 32px;
      height: 32px;
      cursor: pointer;
      position: relative;
    }

    .selected-icons .cross {
      position: absolute;
      bottom: -5px;
      right: -5px;
      width: 16px;
      height: 16px;
      background-color: red;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      line-height: 1;
    }

    #info-box {
      font-family: Arial, sans-serif;
      font-size: 12px;
      position: absolute;
      bottom: 10px;
      right: 10px;
      width: 300px;
      background-color: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      display: none;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div id="map" style="width: 100%; height: 600px;"></div>
  <div id="info-box"></div>
  <div class="selected-icons" id="selected-icons"></div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://unpkg.com/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.5.1/gpx.min.js"></script>
  <script>
    const map = L.map('map').setView([43.492949, -1.474841], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    const officesLayer = L.layerGroup().addTo(map);
    const bikeParkingLayer = L.layerGroup();
    const waterPointsLayer = L.layerGroup();
    const bikeRoutesLayer = L.layerGroup();
    const hotelsLayer = L.layerGroup();
    const campingCarLayer = L.layerGroup();
    const campingsLayer = L.layerGroup();
    const autreshebLayer = L.layerGroup();

    let currentGpxLayer = null;
    let currentMarker = null;

    const touristOfficeIcon = L.icon({
      iconUrl: 'icons/tourist_office.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    const bikeParkingIcon = L.icon({
      iconUrl: 'icons/bicycle_parking.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    const waterPointIcon = L.icon({
      iconUrl: 'icons/water_point.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    const hotelIcon = L.icon({
      iconUrl: 'icons/logo_acc_velo.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    const campingCarIcon = L.icon({
      iconUrl: 'icons/camping-car.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    const campingIcon = L.icon({
      iconUrl: 'icons/logo_acc_velo.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    const autreshebIcon = L.icon({
      iconUrl: 'icons/logo_acc_velo.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    const bikeIcon = L.icon({
      iconUrl: 'icons/velo.png',
      iconSize: [32, 32],
      iconAnchor: [16, 32],
      popupAnchor: [0, -32]
    });

    // Fonction de mappage pour les types de parkings à vélo
    function mapBicycleParkingType(type) {
      const mapping = {
        'stands': 'arceaux',
        'wall_loops': 'ratelier',
        'shed': 'abri vélo'
      };
      return mapping[type] || type;
    }

    // Fonction de formatage de la raison sociale avec des - à la place des espaces pour le bouton en savoir plus
    function formatRaisonSociale(raisonSociale) {
      return raisonSociale.replace(/\s+/g, '-');
    }

    // Ajoute les parcours de vélo à la couche spécifiée
    function addBikeRoutesLayer(url, layer) {
      $.getJSON(url, function(data) {
        L.geoJson(data, {
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, { icon: bikeIcon });
          },
          onEachFeature: function (feature, layer) {
            const tempsDifficulte = feature.properties.ITITEMPSDIF.replace(/\|/g, ' - ');
            let popupContent = `<span style="font-size: 14px;"><strong>${feature.properties.SyndicObjectName}</strong></span><br><br>`;
            
            if (feature.properties.PHOTO) {
              popupContent += `<img src="https://cdt64.media.tourinsoft.eu/upload/${feature.properties.PHOTO}" width="200px"><br><br>`;
            }
            popupContent += `<strong>${tempsDifficulte}<br>${feature.properties.DISTANCE} km<br></strong><br>`;
            
            const commune = feature.properties.COMMUNE;
            const syndicObjectID = feature.properties.SyndicObjectID;
            const syndicObjectName = feature.properties.SyndicObjectName.replace(/ /g, '-').replace(/'/g, '-');
            const moreInfoLink = `https://www.tourisme64.com/itineraire/${commune}/${syndicObjectID}-${syndicObjectName}`;

            popupContent += `<a href="${moreInfoLink}" target="_blank" class="en-savoir-plus-button2">En savoir plus</a>`;
            
            layer.on('click', function() {
              if (currentGpxLayer) {
                map.removeLayer(currentGpxLayer);
              }
              if (currentMarker) {
                currentMarker.setIcon(bikeIcon);
              }
              layer.setIcon(L.icon({
                iconUrl: 'icons/velo.png',
                iconSize: [48, 48],
                iconAnchor: [16, 32],
                popupAnchor: [0, -32],
                className: 'darkened-icon'
              }));
              currentMarker = layer;
              
              const gpxUrl = `https://cdt64.media.tourinsoft.eu/upload/${feature.properties.DOCGPX}`;
              currentGpxLayer = new L.GPX(gpxUrl, {
                async: true,
                marker_options: {
                  startIconUrl: '',
                  endIconUrl: '',
                  shadowUrl: '',
                  wptIconUrls: {
                    '': ''
                  }
                },
                polyline_options: {
                  color: 'red',
                  weight: 5,
                  opacity: 0.7,
                  dashArray: '5, 10'
                }
              }).on('loaded', function(e) {
                map.fitBounds(e.target.getBounds());
              }).addTo(map);
              showInfoBox(popupContent);
            });
          }
        }).addTo(layer);
      });
    }

    // Ajoute des données à la couche spécifiée
    function addDataToLayer(url, layer, color, isOffice = false) {
      $.getJSON(url, function(data) {
        data.elements.forEach(function(element) {
          let popupContent = "";
          if (element.tags) {
            if (isOffice) {
              popupContent += `<strong>${element.tags.name || "No name"}</strong><br><br>`;
              if (element.tags.phone) popupContent += `Téléphone : ${element.tags.phone}<br>`;
              if (element.tags.website) popupContent += `Site web : <a href="${element.tags.website}" target="_blank">${element.tags.website}</a><br>`;
              if (element.tags.email) popupContent += `Email : <a href="mailto:${element.tags.email}">${element.tags.email}</a><br>`;
              if (element.tags.opening_hours) popupContent += `Heures d'ouverture : ${translateOpeningHours(element.tags.opening_hours)}<br><br>`;
              if (element.tags.description) popupContent += `<strong>Description :</strong> ${element.tags.description}<br>`;
              popupContent += `(source OSM)`;
            } else {
              popupContent += element.tags.name || "No name";
            }
          }

          if (element.type === "node") {
            const markerOptions = isOffice ? { icon: touristOfficeIcon } : { icon: L.divIcon({ className: 'custom-icon', html: `<div style="background-color: ${color}; width: 12px; height: 12px; border-radius: 50%;"></div>` }) };
            const marker = L.marker([element.lat, element.lon], markerOptions);
            marker.on('click', function(e) {
              L.DomEvent.stopPropagation(e); // Empêche la propagation de l'événement click à la carte
              showInfoBox(popupContent);
            });
            layer.addLayer(marker);
          } else if (element.type === "way") {
            const latlngs = element.geometry.map(function(geo) {
              return [geo.lat, geo.lon];
            });
            const polygon = L.polygon(latlngs, { color: color });
            polygon.on('click', function() {
              showInfoBox(popupContent);
            });
            layer.addLayer(polygon);

            // Calculer le centroïde du polygone
            const centroid = polygon.getBounds().getCenter();
            const markerOptions = isOffice ? { icon: touristOfficeIcon } : { icon: L.divIcon({ className: 'custom-icon', html: `<div style="background-color: ${color}; width: 12px; height: 12px; border-radius: 50%;"></div>` }) };
            const marker = L.marker(centroid, markerOptions);
            marker.on('click', function(e) {
              L.DomEvent.stopPropagation(e); // Empêche la propagation de l'événement click à la carte
              showInfoBox(popupContent);
            });
            layer.addLayer(marker);
          }
        });
      });
    }

    function addGeoJsonLayer(url, layer, icon, type) {
      $.getJSON(url, function(data) {
        L.geoJson(data, {
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, { icon: icon });
          },
          onEachFeature: function (feature, layer) {
            let popupContent = "";
            if (feature.properties) {
              if (type === 'bike_parking') {
                popupContent += `<strong>Parking à vélo</strong><br>`;
                if (feature.properties.capacity) popupContent += `Capacité : ${feature.properties.capacity} places<br>`;
                if (feature.properties.bicycle_parking) popupContent += `Type : ${mapBicycleParkingType(feature.properties.bicycle_parking)}<br>`;
                popupContent += `(source OSM)`;
              } else if (type === 'hotel') {
                if (feature.properties["Raison sociale"]) popupContent += `<span style="font-size: 14px;"><strong>${feature.properties["Raison sociale"]}</strong></span><br>`;
                if (feature.properties["Classement"]) popupContent += `<strong>${feature.properties["Classement"]}</strong><br>`;
                if (feature.properties["Lien première photo"]) popupContent += `<img src="${feature.properties["Lien première photo"]}" width="200px"><br>`;
                if (feature.properties["Capacité Nb logements"]) popupContent += `${feature.properties["Capacité Nb logements"]}<br>`;
                if (feature.properties["TEL"]) popupContent += `Tel.${feature.properties["TEL"]}<br>`;
                if (feature.properties.URL) popupContent += `Site web : <a href="${feature.properties.URL}" target="_blank">${feature.properties.URL}</a><br><br>`;
                if (feature.properties.Commune && feature.properties.Identifiant && feature.properties["Raison sociale"]) {
                  const commune = feature.properties.Commune;
                  const identifiant = feature.properties.Identifiant;
                  const raisonSociale = formatRaisonSociale(feature.properties["Raison sociale"]);
                  const moreInfoUrl = `https://www.tourisme64.com/hebergements/hotels/${commune}/${identifiant}-${raisonSociale}/`;
                  popupContent += `<a href="${moreInfoUrl}" target="_blank" class="en-savoir-plus-button">En savoir plus</a>`;
                }
              } else if (type === 'camping') {
                if (feature.properties["Raison sociale"]) popupContent += `<span style="font-size: 14px;"><strong>${feature.properties["Raison sociale"]}</strong></span><br>`;
                if (feature.properties["Classement"]) popupContent += `<strong>${feature.properties["Classement"]}</strong><br>`;
                if (feature.properties["Lien première photo"]) popupContent += `<img src="${feature.properties["Lien première photo"]}" width="200px"><br>`;
                if (feature.properties["Capacité Nb logements"]) popupContent += `${feature.properties["Capacité Nb logements"]} emplacements<br>`;
                if (feature.properties["TEL"]) popupContent += `Tel.${feature.properties["TEL"]}<br>`;
                if (feature.properties.URL) popupContent += `Site web : <a href="${feature.properties.URL}" target="_blank">${feature.properties.URL}</a><br><br>`;
                if (feature.properties.Commune && feature.properties.Identifiant && feature.properties["Raison sociale"]) {
                  const commune = feature.properties.Commune;
                  const identifiant = feature.properties.Identifiant;
                  const raisonSociale = formatRaisonSociale(feature.properties["Raison sociale"]);
                  const moreInfoUrl = `https://www.tourisme64.com/hebergements/camping/${commune}/${identifiant}-${raisonSociale}/`;
                  popupContent += `<a href="${moreInfoUrl}" target="_blank" class="en-savoir-plus-button">En savoir plus</a>`;
                }
              } else if (type === 'camping-car') {
                if (feature.properties["Raison sociale"]) popupContent += `<span style="font-size: 14px;"><strong>${feature.properties["Raison sociale"]}</strong></span><br>`;
                if (feature.properties["Lien première photo"]) popupContent += `<img src="${feature.properties["Lien première photo"]}" width="200px"><br>`;
                if (feature.properties["Capacité Nb logements"]) popupContent += `${feature.properties["Capacité Nb logements"]}<br>`;
                if (feature.properties["Equipement"]) popupContent += `${feature.properties["Equipement"]}<br>`;
                if (feature.properties.Commune && feature.properties.Identifiant && feature.properties["Raison sociale"]) {
                  const commune = feature.properties.Commune;
                  const identifiant = feature.properties.Identifiant;
                  const raisonSociale = formatRaisonSociale(feature.properties["Raison sociale"]);
                  const moreInfoUrl = `https://www.tourisme64.com/hebergements/aire-de-camping-car/${commune}/${identifiant}-${raisonSociale}/`;
                  popupContent += `<a href="${moreInfoUrl}" target="_blank" class="en-savoir-plus-button">En savoir plus</a>`;
                }
              } else {
                if (feature.properties["Raison sociale"]) popupContent += `<span style="font-size: 14px;"><strong>${feature.properties["Raison sociale"]}</strong></span><br>`;
                if (feature.properties["Classement"]) popupContent += `<strong>${feature.properties["Classement"]}</strong><br>`;
                if (feature.properties["Lien première photo"]) popupContent += `<img src="${feature.properties["Lien première photo"]}" width="200px"><br>`;
                if (feature.properties["Capacité Nb logements"]) popupContent += `${feature.properties["Capacité Nb logements"]}<br>`;
                if (feature.properties["TEL"]) popupContent += `Tel.${feature.properties["TEL"]}<br>`;
                if (feature.properties.URL) popupContent += `Site web : <a href="${feature.properties.URL}" target="_blank">${feature.properties.URL}</a><br><br>`;
                
                // Ajout de la condition pour afficher le bouton en savoir plus selon le type d'hébergement
                if (feature.properties["Identifiant"]) {
                  if (feature.properties["Identifiant"].startsWith("VIL")) {
                    if (feature.properties.Commune && feature.properties.Identifiant && feature.properties["Raison sociale"]) {
                      const commune = feature.properties.Commune;
                      const identifiant = feature.properties.Identifiant;
                      const raisonSociale = formatRaisonSociale(feature.properties["Raison sociale"]);
                      const moreInfoUrl = `https://www.tourisme64.com/hebergements/village-de-vacances/${commune}/${identifiant}-${raisonSociale}/`;
                      popupContent += `<a href="${moreInfoUrl}" target="_blank" class="en-savoir-plus-button">En savoir plus</a>`;
                    }
                  } else if (feature.properties["Identifiant"].startsWith("RET")) {
                    if (feature.properties.Commune && feature.properties.Identifiant && feature.properties["Raison sociale"]) {
                      const commune = feature.properties.Commune;
                      const identifiant = feature.properties.Identifiant;
                      const raisonSociale = formatRaisonSociale(feature.properties["Raison sociale"]);
                      const moreInfoUrl = `https://www.tourisme64.com/hebergements/residence-de-tourisme/${commune}/${identifiant}-${raisonSociale}/`;
                      popupContent += `<a href="${moreInfoUrl}" target="_blank" class="en-savoir-plus-button">En savoir plus</a>`;
                    }
                  } else if (feature.properties["Identifiant"].startsWith("HLO")) {
                    if (feature.properties.Commune && feature.properties.Identifiant && feature.properties["Raison sociale"]) {
                      const commune = feature.properties.Commune;
                      const identifiant = feature.properties.Identifiant;
                      const raisonSociale = formatRaisonSociale(feature.properties["Raison sociale"]);
                      const moreInfoUrl = `https://www.tourisme64.com/hebergements/chambre-d-hotes/${commune}/${identifiant}-${raisonSociale}/`;
                      popupContent += `<a href="${moreInfoUrl}" target="_blank" class="en-savoir-plus-button">En savoir plus</a>`;
                    }
                  } else if (feature.properties["Identifiant"].startsWith("HCO")) {
                    if (feature.properties.Commune && feature.properties.Identifiant && feature.properties["Raison sociale"]) {
                      const commune = feature.properties.Commune;
                      const identifiant = feature.properties.Identifiant;
                      const raisonSociale = formatRaisonSociale(feature.properties["Raison sociale"]);
                      const moreInfoUrl = `https://www.tourisme64.com/hebergements/hebergement-collectif/${commune}/${identifiant}-${raisonSociale}/`;
                      popupContent += `<a href="${moreInfoUrl}" target="_blank" class="en-savoir-plus-button">En savoir plus</a>`;
                    }
                  }
                }
              }
            }
            if (popupContent) {
              layer.on('click', function() {
                showInfoBox(popupContent);
              });
            }
          }
        }).addTo(layer);
      });
    }

    function addKmlLayer(url, layer) {
      omnivore.kml(url).addTo(layer);
    }

    // Boite d'info à la place bulle
    function hideInfoBox() {
      const infoBox = document.getElementById('info-box');
      infoBox.style.display = 'none';
    }

    function showInfoBox(content) {
      const infoBox = document.getElementById('info-box');
      infoBox.innerHTML = content;
      infoBox.style.display = 'block';
    }

    // Ajoute cet événement pour masquer la boîte d'information lorsque l'utilisateur clique sur la carte
    map.on('click', function() {
      hideInfoBox();
      if (currentGpxLayer) {
        map.removeLayer(currentGpxLayer);
        currentGpxLayer = null;
      }
    });

    const officesUrl = 'https://overpass-api.de/api/interpreter?data=[out:json][timeout:25];area(id:3600007450)->.searchArea;nwr"information"="office";out geom;';
    const bikeParkingUrl = 'data/bike_parking.geojson';
    const waterPointsUrl = 'data/water_points.geojson';
    const hotelsUrl = 'data/HOT.geojson';
    const campingCarUrl = 'data/ACC.geojson';
    const campingsUrl = 'data/HPA.geojson';
    const autreshebUrl = 'data/AUTRESHEEB.geojson';
    const kmlFiles = ['KMLVELO/Velodyssee-Bayonne-BTZ-14122015.kml', 'KMLVELO/la-velodyssee-de-biarritz-a-st-jean-de-luz-etape-n19.kml', 'KMLVELO/cyclokml-nive-et-ocean.kml', 'KMLVELO/la-v-81-de-biarritz-a-urt-etape-n1.kml'];
    const BikeRoutesUrl = 'data/ITIVELO.geojson';

    const customControl = L.Control.extend({
      options: {
        position: 'topleft'
      },
      onAdd: function (map) {
        const container = L.DomUtil.create('div', 'leaflet-control-custom');

        const header = L.DomUtil.create('div', 'header', container);

        const logo = L.DomUtil.create('img', '', header);
        logo.src = 'icons/LOGO_VISIT64.png';
        
        const title = L.DomUtil.create('h2', '', header);
        title.innerHTML = 'Carte vélo 64';

        const buttonContainer = L.DomUtil.create('div', 'button-container', container);

        const buttonOffices = L.DomUtil.create('button', 'offices-button', container);
        buttonOffices.innerHTML = '<img src="icons/tourist_office.png" alt="Office de Tourisme" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 5px;"> Offices de Tourisme';
        L.DomEvent.on(buttonOffices, 'click', function () {
          toggleLayer(officesLayer, officesUrl, null, null, 'icons/tourist_office.png', function(url, layer) {
            addDataToLayer(url, layer, '#007bff', true);
          });
        });

        const buttonBikeRoutes = L.DomUtil.create('button', 'parcours-button', buttonContainer);
        buttonBikeRoutes.innerHTML = 'Parcours vélo';
        L.DomEvent.on(buttonBikeRoutes, 'click', function () {
          toggleLayer(bikeRoutesLayer, 'data/ITIVELO.geojson', null, null, 'icons/velo.png', function(url, layer) {
            addBikeRoutesLayer(url, layer);
          });
        });

        const buttonBike = L.DomUtil.create('button', 'bike-button', container);
        buttonBike.innerHTML = 'Mobilité et Services';
        const submenu = L.DomUtil.create('div', 'submenu bike-submenu', container);

        const buttonBikeParking = L.DomUtil.create('button', '', submenu);
        buttonBikeParking.innerHTML = 'Parking à vélo';
        L.DomEvent.on(buttonBikeParking, 'click', function () {
          toggleLayer(bikeParkingLayer, bikeParkingUrl, bikeParkingIcon, 'bike_parking', 'icons/bicycle_parking.png', addGeoJsonLayer);
        });

        const buttonWaterPoints = L.DomUtil.create('button', '', submenu);
        buttonWaterPoints.innerHTML = 'Points d\'eau';
        L.DomEvent.on(buttonWaterPoints, 'click', function () {
          toggleLayer(waterPointsLayer, waterPointsUrl, waterPointIcon, 'water_point', 'icons/water_point.png', addGeoJsonLayer);
        });

        L.DomEvent.on(buttonBike, 'click', function () {
          submenu.style.display = (submenu.style.display === 'none' || submenu.style.display === '') ? 'block' : 'none';
        });

        const buttonAccommodations = L.DomUtil.create('button', 'accommodations-button', container);
        buttonAccommodations.innerHTML = 'Hébergements Accueil vélo';
        const submenuAccommodations = L.DomUtil.create('div', 'submenu accommodations-submenu', container);

        const buttonHotels = L.DomUtil.create('button', '', submenuAccommodations);
        buttonHotels.innerHTML = 'Hôtels';
        L.DomEvent.on(buttonHotels, 'click', function () {
          toggleLayer(hotelsLayer, hotelsUrl, hotelIcon, 'hotel', 'icons/hotel.png', addGeoJsonLayer);
        });

                const buttonCampings = L.DomUtil.create('button', '', submenuAccommodations);
        buttonCampings.innerHTML = 'Campings';
        L.DomEvent.on(buttonCampings, 'click', function () {
          toggleLayer(campingsLayer, campingsUrl, campingIcon, 'camping', 'icons/camping.png', addGeoJsonLayer);
        });

        const buttonautresheb = L.DomUtil.create('button', '', submenuAccommodations);
        buttonautresheb.innerHTML = 'Autres hébergements';
        L.DomEvent.on(buttonautresheb, 'click', function () {
          toggleLayer(autreshebLayer, autreshebUrl, autreshebIcon, 'autresheb', 'icons/logo_acc_velo.png', addGeoJsonLayer);
        });

        const buttonCampingCar = L.DomUtil.create('button', '', submenuAccommodations);
        buttonCampingCar.innerHTML = 'Aires de camping-car';
        L.DomEvent.on(buttonCampingCar, 'click', function () {
          toggleLayer(campingCarLayer, campingCarUrl, campingCarIcon, 'camping_car', 'icons/camping-car.png', addGeoJsonLayer);
        });

        L.DomEvent.on(buttonAccommodations, 'click', function () {
          submenuAccommodations.style.display = (submenuAccommodations.style.display === 'none' || submenuAccommodations.style.display === '') ? 'block' : 'none';
        });

        return container;
      }
    });

    map.addControl(new customControl());

    // Fonction pour afficher infoBox à la place de Info bulle
    function showInfoBox(content) {
      const infoBox = document.getElementById('info-box');
      infoBox.innerHTML = content;
      infoBox.style.display = 'block';
    }

    // Fonction pour ajouter les icones sélectionnées avec croix pour les supprimer
    function toggleLayer(layer, url, icon, type, iconUrl, callback) {
      if (map.hasLayer(layer)) {
        map.removeLayer(layer);
        removeSelectedIcon(iconUrl);
      } else {
        if (callback) {
          callback(url, layer, icon, type);
        }
        map.addLayer(layer);
        addSelectedIcon(iconUrl, layer);
      }
    }

    function addSelectedIcon(iconUrl, layer) {
      const selectedIconsContainer = document.getElementById('selected-icons');
      if (!selectedIconsContainer) return;

      const iconWrapper = document.createElement('div');
      iconWrapper.style.position = 'relative';

      const img = document.createElement('img');
      img.src = iconUrl;
      img.dataset.layer = layer._leaflet_id;
      img.onclick = function() {
        map.removeLayer(layer);
        selectedIconsContainer.removeChild(iconWrapper);
      };

      const cross = document.createElement('div');
      cross.className = 'cross';
      cross.innerHTML = '✖';
      cross.onclick = function() {
        map.removeLayer(layer);
        selectedIconsContainer.removeChild(iconWrapper);
      };

      iconWrapper.appendChild(img);
      iconWrapper.appendChild(cross);
      selectedIconsContainer.appendChild(iconWrapper);
    }

    function removeSelectedIcon(iconUrl) {
      const selectedIconsContainer = document.getElementById('selected-icons');
      if (!selectedIconsContainer) return;

      const imgs = selectedIconsContainer.getElementsByTagName('img');
      Array.from(imgs).forEach(function(img) {
        if (img.src.includes(iconUrl)) {
          selectedIconsContainer.removeChild(img.parentElement);
        }
      });
    }
  </script>
</body>
</html>
1
