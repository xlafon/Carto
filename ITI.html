<!DOCTYPE html>
<html>
<head>
    <title>Carte Bayonne</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.5.1/gpx.min.js"></script>
</head>
<body>
    <div id="map" style="width: 100%; height: 600px;"></div>
    <script>
        // Initialiser la carte centrée sur Bayonne
        var map = L.map('map').setView([43.492949, -1.474841], 10);

        // Ajouter la couche OpenStreetMap normal
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var gpxLayers = {};

        // Fonction pour ajouter les gares
        function addGares() {
            var overpassUrl = 'https://overpass-api.de/api/interpreter?data=[out:json][timeout:25];area(id:3600007450)->.searchArea;nwr"railway"="station";out geom;';
            $.getJSON(overpassUrl, function(data) {
                data.elements.forEach(function(station) {
                    L.marker([station.lat, station.lon])
                        .bindPopup(station.tags.name)
                        .addTo(map);
                });
            });
        }

        // Fonction pour ajouter les parcours vélo
        function addParcoursVelo() {
            $.getJSON('data/ITIVELO.geojson', function(data) {
                L.geoJSON(data, {
                    onEachFeature: function (feature, layer) {
                        var popupContent = "<b>" + feature.properties.SyndicObjectName + "</b><br>" +
                                           //feature.properties.DESCRIPTIF + "<br>" +
                                           "Temps: " + feature.properties.ITITEMPSDIF + "<br>" +
                                           "Distance: " + feature.properties.DISTANCE + " km";
                        if (feature.properties.DOCGPX) {
                            var gpxUrl = "https://cdt64.media.tourinsoft.eu/upload/" + feature.properties.DOCGPX;
                            popupContent += "<br><a href='" + gpxUrl + "' target='_blank'>Voir le parcours GPX</a>";
                        }
                        if (feature.properties.PHOTO) {
                            var photoUrl = "https://cdt64.media.tourinsoft.eu/upload/" + feature.properties.PHOTO;
                            popupContent += "<br><img src='" + photoUrl + "' alt='Photo' style='width:100px;height:auto;'>";
                        }
                        layer.bindPopup(popupContent);

                        // Charger et afficher le fichier GPX par défaut
                        if (feature.properties.DOCGPX) {
                            var gpxUrl = "https://cdt64.media.tourinsoft.eu/upload/" + feature.properties.DOCGPX;
                            var gpxLayer = new L.GPX(gpxUrl, {
                                async: true,
                                marker_options: {
                                    startIconUrl: '',
                                    endIconUrl: '',
                                    wptIconUrl: '',
                                    shadowUrl: ''
                                },
                                polyline_options: {
                                    color: 'blue',
                                    weight: 5,
                                    opacity: 0.7,
                                    dashArray: '5, 10'
                                }
                            }).on('loaded', function(e) {
                                map.fitBounds(e.target.getBounds());
                            }).addTo(map);
                            gpxLayers[feature.properties.DOCGPX] = gpxLayer;
                        }

                        layer.on('click', function() {
                            if (feature.properties.DOCGPX) {
                                var gpxUrl = "https://cdt64.media.tourinsoft.eu/upload/" + feature.properties.DOCGPX;
                                if (map.hasLayer(gpxLayers[feature.properties.DOCGPX])) {
                                    map.removeLayer(gpxLayers[feature.properties.DOCGPX]);
                                } else {
                                    gpxLayers[feature.properties.DOCGPX].addTo(map);
                                }
                            }
                        });
                    }
                }).addTo(map);
            });
        }

        // Ajouter les menus dynamiques
        var menu = $('<div id="menu"><button id="gares">Gares</button><button id="parcours">Parcours Vélo</button></div>');
        $('body').append(menu);

        $('#gares').on('click', addGares);
        $('#parcours').on('click', addParcoursVelo);
    </script>
</body>
</html>
7
