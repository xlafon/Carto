<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte Vélo 64</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        /* Styles généraux pour la carte */
        #map {
            height: 100vh; /* Hauteur de la carte */
        }

        /* Style pour le conteneur d'informations */
        #info-box {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none; /* Par défaut, cacher la boîte d'informations */
        }

        /* Styles pour les boutons de contrôle */
        .leaflet-control-custom {
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .button-container button {
            display: block;
            margin: 5px 0;
            padding: 8px;
            cursor: pointer;
            width: 100%;
            border: none;
            border-radius: 5px;
            color: white;
            font-weight: bold;
        }

        .offices-button {
            background-color: #007bff; /* Couleur pour les bureaux de tourisme */
        }

        .parcours-button {
            background-color: #28a745; /* Couleur pour les parcours vélo */
        }

        .bike-button {
            background-color: #17a2b8; /* Couleur pour la mobilité et services */
        }

        .accommodations-button {
            background-color: #ffc107; /* Couleur pour les hébergements */
        }

        .button-container button:hover {
            opacity: 0.9; /* Légère transparence au survol */
        }

        /* Style pour les sous-menus */
        .submenu {
            display: none;
            margin-top: 5px;
        }

        /* Style pour les icônes sélectionnées */
        #selected-icons {
            position: absolute;
            top: 10px; /* Position en haut pour la boîte d'icônes */
            right: 10px; /* Alignement à droite */
            z-index: 1000;
            display: flex;
            flex-wrap: wrap; /* Permet le passage à la ligne */
        }

        #selected-icons img {
            width: 30px; /* Taille des icônes */
            height: 30px; /* Taille des icônes */
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .cross {
            position: absolute;
            top: 0;
            right: 0;
            cursor: pointer;
            color: red;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div id="info-box"></div>
    <div id="selected-icons"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Initialiser la carte centrée sur les coordonnées données
        var map = L.map('map').setView([43.4711, -1.5587], 12);

        // Ajouter une couche de tuiles OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Initialisation des couches pour différents types de données
        var currentGpxLayer = null;
        var officesLayer = L.layerGroup();
        var bikeRoutesLayer = L.layerGroup();
        var bikeParkingLayer = L.layerGroup();
        var waterPointsLayer = L.layerGroup();
        var hotelsLayer = L.layerGroup();
        var campingsLayer = L.layerGroup();
        var autreshebLayer = L.layerGroup();
        var campingCarLayer = L.layerGroup();

        // URLs pour charger les données GeoJSON
        var officesUrl = 'https://overpass-api.de/api/interpreter?data=[out:json][timeout:25];area(id:3600007450)->.searchArea;nwr["information"="office"](area.searchArea);out geom;';
        var bikeParkingUrl = 'data/bike_parking.geojson';
        var waterPointsUrl = 'data/water_points.geojson';
        var hotelsUrl = 'data/HOT.geojson';
        var campingCarUrl = 'data/ACC.geojson';
        var campingsUrl = 'data/HPA.geojson';
        var autreshebUrl = 'data/AUTRESHEEB.geojson';
        var BikeRoutesUrl = 'data/ITIVELO.geojson';

        // Masquer la boîte d'information
        function hideInfoBox() {
            var infoBox = document.getElementById('info-box');
            infoBox.style.display = 'none'; // Cacher la boîte d'information
        }

        // Afficher la boîte d'information avec le contenu donné
        function showInfoBox(content) {
            var infoBox = document.getElementById('info-box');
            infoBox.innerHTML = content; // Mettre à jour le contenu
            infoBox.style.display = 'block'; // Afficher la boîte d'information
        }

        // Événement de clic sur la carte
        map.on('click', function() {
            hideInfoBox(); // Masquer la boîte d'information au clic sur la carte
            if (currentGpxLayer) {
                map.removeLayer(currentGpxLayer); // Retirer la couche GPX si elle existe
                currentGpxLayer = null; // Réinitialiser la couche GPX actuelle
            }
        });

        // Contrôle personnalisé pour gérer les couches de la carte
        var customControl = L.Control.extend({
            options: {
                position: 'topleft' // Position du contrôle sur la carte
            },
            onAdd: function(map) {
                var container = L.DomUtil.create('div', 'leaflet-control-custom');

                // Ajouter le titre et le logo
                var header = L.DomUtil.create('div', 'header', container);
                var logo = L.DomUtil.create('img', '', header);
                logo.src = 'icons/LOGO_VISIT64.png'; // Assurez-vous que le chemin est correct
                var title = L.DomUtil.create('h2', '', header);
                title.innerHTML = 'Carte vélo 64';

                // Conteneur pour les boutons
                var buttonContainer = L.DomUtil.create('div', 'button-container', container);

                // Bouton pour les bureaux de tourisme
                var buttonOffices = L.DomUtil.create('button', 'offices-button', buttonContainer);
                buttonOffices.innerHTML = '<img src="icons/tourist_office.png" alt="Office de Tourisme" style="width: 20px; height: 20px; vertical-align: middle; margin-right: 5px;"> Offices de Tourisme';
                L.DomEvent.on(buttonOffices, 'click', function() {
                    toggleLayer(officesLayer, officesUrl, null, null, 'icons/tourist_office.png', addOfficesLayer);
                });

                // Bouton pour les parcours vélo
                var buttonBikeRoutes = L.DomUtil.create('button', 'parcours-button', buttonContainer);
                buttonBikeRoutes.innerHTML = 'Parcours vélo';
                L.DomEvent.on(buttonBikeRoutes, 'click', function() {
                    toggleLayer(bikeRoutesLayer, BikeRoutesUrl, '#ff0000', false, 'icons/velo.png', addBikeRoutesLayer);
                });

                // Bouton pour la mobilité et services
                var buttonBike = L.DomUtil.create('button', 'bike-button', buttonContainer);
                buttonBike.innerHTML = 'Mobilité et Services';
                var submenu = L.DomUtil.create('div', 'submenu bike-submenu', buttonContainer);

                // Sous-menu pour le parking à vélo
                var buttonBikeParking = L.DomUtil.create('button', '', submenu);
                buttonBikeParking.innerHTML = 'Parking à vélo';
                L.DomEvent.on(buttonBikeParking, 'click', function() {
                    toggleLayer(bikeParkingLayer, bikeParkingUrl, '#28a745', true, 'icons/bicycle_parking.png', addGeoJsonLayer);
                });

                // Sous-menu pour les points d'eau
                var buttonWaterPoints = L.DomUtil.create('button', '', submenu);
                buttonWaterPoints.innerHTML = 'Points d\'eau';
                L.DomEvent.on(buttonWaterPoints, 'click', function() {
                    toggleLayer(waterPointsLayer, waterPointsUrl, '#17a2b8', true, 'icons/water_point.png', addGeoJsonLayer);
                });

                // Afficher ou masquer le sous-menu
                L.DomEvent.on(buttonBike, 'click', function() {
                    submenu.style.display = submenu.style.display === 'none' || submenu.style.display === '' ? 'block' : 'none';
                });

                // Bouton pour les hébergements
                var buttonAccommodations = L.DomUtil.create('button', 'accommodations-button', buttonContainer);
                buttonAccommodations.innerHTML = 'Hébergements';
                var submenuAccommodations = L.DomUtil.create('div', 'submenu accommodations-submenu', buttonContainer);

                // Sous-menu pour les hôtels
                var buttonHotels = L.DomUtil.create('button', '', submenuAccommodations);
                buttonHotels.innerHTML = 'Hôtels';
                L.DomEvent.on(buttonHotels, 'click', function() {
                    toggleLayer(hotelsLayer, hotelsUrl, '#ffc107', true, 'icons/hotel.png', addGeoJsonLayer);
                });

                // Sous-menu pour les campings
                var buttonCampings = L.DomUtil.create('button', '', submenuAccommodations);
                buttonCampings.innerHTML = 'Campings';
                L.DomEvent.on(buttonCampings, 'click', function() {
                    toggleLayer(campingsLayer, campingsUrl, '#ffc107', true, 'icons/camping.png', addGeoJsonLayer);
                });

                // Sous-menu pour les aires de camping-car
                var buttonCampingCar = L.DomUtil.create('button', '', submenuAccommodations);
                buttonCampingCar.innerHTML = 'Aires de Camping-Car';
                L.DomEvent.on(buttonCampingCar, 'click', function() {
                    toggleLayer(campingCarLayer, campingCarUrl, '#ffc107', true, 'icons/camping_car.png', addGeoJsonLayer);
                });

                // Sous-menu pour les autres hébergements
                var buttonAutresHeb = L.DomUtil.create('button', '', submenuAccommodations);
                buttonAutresHeb.innerHTML = 'Autres Hébergements';
                L.DomEvent.on(buttonAutresHeb, 'click', function() {
                    toggleLayer(autreshebLayer, autreshebUrl, '#ffc107', true, 'icons/autres_hebergement.png', addGeoJsonLayer);
                });

                // Afficher ou masquer le sous-menu des hébergements
                L.DomEvent.on(buttonAccommodations, 'click', function() {
                    submenuAccommodations.style.display = submenuAccommodations.style.display === 'none' || submenuAccommodations.style.display === '' ? 'block' : 'none';
                });

                return container; // Retourner le conteneur du contrôle
            }
        });

        // Ajouter le contrôle personnalisé à la carte
        map.addControl(new customControl());

        // Fonction pour afficher ou masquer les couches
        function toggleLayer(layer, url, color, isGeoJson, iconUrl, callback) {
            if (map.hasLayer(layer)) {
                map.removeLayer(layer); // Retirer la couche si elle est déjà visible
                removeSelectedIcon(iconUrl); // Retirer l'icône sélectionnée
            } else {
                layer.clearLayers(); // Nettoyer la couche avant d'ajouter de nouvelles données
                if (isGeoJson) {
                    addGeoJsonLayer(url, layer); // Ajouter une couche GeoJSON
                } else {
                    addDataToLayer(url, layer, color); // Ajouter des données avec un style
                }
                callback(url, layer, iconUrl); // Appeler le callback pour ajouter l'icône sélectionnée
                map.addLayer(layer); // Ajouter la couche à la carte
                addSelectedIcon(iconUrl, layer); // Ajouter l'icône sélectionnée au conteneur
            }
        }

        // Fonction pour ajouter une icône sélectionnée
        function addSelectedIcon(iconUrl, layer) {
            var selectedIconsContainer = document.getElementById('selected-icons');
            if (!selectedIconsContainer) return;

            var iconWrapper = document.createElement('div'); // Créer un conteneur pour l'icône
            iconWrapper.style.position = 'relative'; // Positionner l'icône

            var img = document.createElement('img'); // Créer une image pour l'icône
            img.src = iconUrl; // Définir la source de l'image
            img.dataset.layer = layer._leaflet_id; // Stocker l'identifiant de la couche

            // Fonction de clic pour supprimer l'icône de la sélection
            img.onclick = function() {
                map.removeLayer(layer); // Retirer la couche de la carte
                selectedIconsContainer.removeChild(iconWrapper); // Supprimer l'icône du conteneur
            };

            var cross = document.createElement('div'); // Créer un symbole de suppression
            cross.className = 'cross'; // Ajouter une classe pour le style
            cross.innerHTML = '✖'; // Définir le symbole
            cross.onclick = function() {
                map.removeLayer(layer); // Retirer la couche de la carte
                selectedIconsContainer.removeChild(iconWrapper); // Supprimer l'icône du conteneur
            };

            iconWrapper.appendChild(img); // Ajouter l'image au conteneur
            iconWrapper.appendChild(cross); // Ajouter le symbole de suppression
            selectedIconsContainer.appendChild(iconWrapper); // Ajouter le conteneur au conteneur d'icônes sélectionnées
        }

        // Fonction pour retirer une icône sélectionnée
        function removeSelectedIcon(iconUrl) {
            var selectedIconsContainer = document.getElementById('selected-icons');
            if (!selectedIconsContainer) return;

            var imgs = selectedIconsContainer.getElementsByTagName('img'); // Récupérer toutes les images
            Array.from(imgs).forEach(function(img) {
                if (img.src.includes(iconUrl)) {
                    selectedIconsContainer.removeChild(img.parentElement); // Retirer l'icône du conteneur
                }
            });
        }

        // Fonction pour ajouter des données à une couche
        function addDataToLayer(url, layer, color) {
            fetch(url) // Charger les données depuis l'URL
                .then(response => response.json()) // Convertir la réponse en JSON
                .then(data => {
                    L.geoJSON(data, {
                        style: function() {
                            return { color: color || '#3388ff' }; // Définir la couleur des géométries
                        },
                        onEachFeature: function(feature, layer) {
                            layer.on('click', function() {
                                var content = '<h4>' + feature.properties.id + '</h4>'; // Utiliser l'identifiant pour le contenu
                                showInfoBox(content); // Afficher des informations sur la couche
                            });
                        }
                    }).addTo(layer); // Ajouter les données à la couche
                })
                .catch(err => console.error('Erreur lors du chargement des données:', err)); // Gérer les erreurs
        }

        // Fonction pour ajouter une couche GeoJSON
        function addGeoJsonLayer(url, layer) {
            fetch(url) // Charger les données depuis l'URL
                .then(response => response.json()) // Convertir la réponse en JSON
                .then(data => {
                    L.geoJSON(data, {
                        onEachFeature: function(feature, layer) {
                            layer.on('click', function() {
                                var content = '<h4>' + feature.properties.id + '</h4>'; // Utiliser l'identifiant pour le contenu
                                showInfoBox(content); // Afficher des informations sur la couche
                            });
                        }
                    }).addTo(layer); // Ajouter les données GeoJSON à la couche
                })
                .catch(err => console.error('Erreur lors du chargement des données GeoJSON:', err)); // Gérer les erreurs
        }

        // Fonction pour ajouter des parcours de vélo
        function addBikeRoutesLayer(url, layer) {
            fetch(url) // Charger les données depuis l'URL
                .then(response => response.json()) // Convertir la réponse en JSON
                .then(data => {
                    L.geoJSON(data, {
                        style: { color: '#ff0000', weight: 3 }, // Définir le style des parcours de vélo
                        onEachFeature: function(feature, layer) {
                            layer.on('click', function() {
                                var content = '<h4>' + feature.properties.id + '</h4>'; // Utiliser l'identifiant pour le contenu
                                showInfoBox(content); // Afficher des informations sur le parcours
                            });
                        }
                    }).addTo(layer); // Ajouter les parcours de vélo à la couche
                })
                .catch(err => console.error('Erreur lors du chargement des parcours de vélo:', err)); // Gérer les erreurs
        }

        // Écouter l'événement de la carte pour masquer la boîte d'information
        map.on('click', hideInfoBox); // Masquer la boîte d'information lors d'un clic sur la carte
    </script>
</body>
</html>

2
